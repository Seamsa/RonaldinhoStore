<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronaldinho Store10 | Sneakers & Street Magic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Grotesk:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #E2A900; --dark: #000100; }
        body { background-color: var(--primary); color: var(--dark); font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; }
        .neo-brutal-shadow { box-shadow: 10px 10px 0px 0px var(--dark); }
        .neo-brutal-shadow-sm { box-shadow: 4px 4px 0px 0px var(--dark); }
        .neo-brutal-shadow-hover:hover { box-shadow: 15px 15px 0px 0px var(--dark); transform: translate(-4px, -4px); }
        .heading-font { font-family: 'Archivo Black', sans-serif; text-transform: uppercase; }
        .custom-cursor { width: 20px; height: 20px; border: 2px solid var(--dark); background: var(--primary); position: fixed; pointer-events: none; z-index: 9999; transition: transform 0.1s ease; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: var(--dark); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border: 3px solid var(--dark); }
        .size-selected { background-color: var(--primary) !important; color: black !important; transform: translate(-2px, -2px); box-shadow: 4px 4px 0px 0px white; }
        #cart-sidebar { transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        #cart-sidebar.open { transform: translateX(0); }
        #cart-overlay { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 60; }
        #cart-overlay.open { opacity: 1; pointer-events: auto; }
        .input-neo { border: 4px solid black; padding: 1rem; width: 100%; font-weight: bold; margin-top: 0.5rem; outline: none; }
        .sold-out-badge { background: #ff0000; color: white; padding: 5px 10px; font-weight: 900; border: 3px solid black; position: absolute; top: 10px; right: 10px; transform: rotate(5deg); z-index: 20; }
        .grayscale-img { filter: grayscale(1); opacity: 0.6; }
    </style>
</head>
<body class="selection:bg-black selection:text-[#E2A900]">

    <div id="cursor" class="custom-cursor hidden md:block"></div>
    <div id="cart-overlay" onclick="toggleCart(false)" class="fixed inset-0 bg-black/60"></div>

    <aside id="cart-sidebar" class="fixed top-0 right-0 h-full w-full md:w-[450px] bg-white z-[70] border-l-8 border-black flex flex-col">
        <div class="p-6 border-b-4 border-black flex justify-between items-center bg-[#E2A900]">
            <h2 class="heading-font text-3xl font-black" data-i18n="cart_title">TON_PANIER</h2>
            <button onclick="toggleCart(false)" class="bg-black text-white p-2 border-2 border-black font-bold">X</button>
        </div>
        
        <div class="p-4 border-b-2 border-black bg-gray-50">
            <div id="sidebar-auth-logged-out">
                <button onclick="toggleCart(false); showView('auth')" class="w-full bg-black text-[#E2A900] p-2 font-bold uppercase hover:bg-gray-800 transition-all text-sm">
                    üë§ SE CONNECTER
                </button>
            </div>
            <div id="sidebar-auth-logged-in" class="hidden">
                <p class="text-sm font-bold mb-2">Compte : <span id="sidebar-user-email" class="text-blue-600"></span></p>
                <button onclick="toggleCart(false); showView('orders')" class="w-full bg-white border-4 border-black p-2 font-bold hover:bg-black hover:text-white transition-all text-sm uppercase mb-1">
                    üìÇ Voir mes commandes
                </button>
                <button onclick="logout()" class="text-xs underline font-bold text-red-600">Se d√©connecter</button>
            </div>
        </div>

        <div id="sidebar-cart-items" class="flex-grow overflow-y-auto p-6 space-y-4 font-bold"></div>
        <div id="sidebar-cart-footer" class="p-6 border-t-4 border-black bg-gray-50">
            <div class="flex justify-between items-center mb-6 font-bold text-2xl heading-font">
                <span data-i18n="total">TOTAL</span>
                <span id="sidebar-total">0 DA</span>
            </div>
            <button type="button" onclick="goToCheckout()" class="w-full bg-black text-[#E2A900] p-6 heading-font text-2xl neo-brutal-shadow-hover transition-all" data-i18n="checkout_btn">FINALISER LA COMMANDE</button>
        </div>
    </aside>

    <nav class="fixed top-0 w-full z-50 p-6 flex justify-between items-center mix-blend-difference">
        <div onclick="showView('home')" class="bg-white border-4 border-black p-2 neo-brutal-shadow-sm cursor-pointer">
            <h1 class="heading-font text-2xl font-bold text-black">R10 STORE</h1>
        </div>
        <div class="flex gap-3 items-center">
            <button onclick="toggleLang()" class="bg-black text-[#E2A900] border-4 border-black px-3 py-2 font-black neo-brutal-shadow-sm hover:bg-white hover:text-black transition-all text-sm" id="langBtn">EN</button>
            <button onclick="showView('map')" class="bg-white border-4 border-black p-2 neo-brutal-shadow-sm hover:translate-y-1 transition-all flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-black"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
            </button>
            <button onclick="toggleCart(true)" class="bg-[#E2A900] border-4 border-black px-4 md:px-6 py-2 heading-font font-bold neo-brutal-shadow-sm">
                <span class="hidden md:inline" data-i18n="nav_cart">PANIER</span> (<span id="cart-count">0</span>)
            </button>
        </div>
    </nav>

    <main id="home-view" class="view-section active">
        <header class="min-h-screen flex flex-col justify-center items-center relative pt-20 px-4 overflow-hidden">
            <div class="relative z-10 text-center">
                <h2 class="heading-font text-6xl md:text-[11rem] leading-none mb-4 -rotate-2 bg-black text-[#E2A900] inline-block px-8 py-4 neo-brutal-shadow" data-i18n="hero_1">LEGENDARY</h2>
                <br>
                <h2 class="heading-font text-6xl md:text-[9rem] leading-none mb-8 rotate-1 bg-white border-8 border-black inline-block px-8 py-4 neo-brutal-shadow" data-i18n="hero_2">FOOTWEAR</h2>
            </div>
            <div class="mt-12 max-w-2xl text-center bg-white border-4 border-black p-8 neo-brutal-shadow relative">
                <p class="text-xl md:text-2xl font-bold uppercase italic" data-i18n="quote">"L'art du dribble commence par le bon appui."</p>
                <div onclick="document.getElementById('catalog').scrollIntoView()" class="absolute -bottom-6 -right-6 bg-[#E2A900] border-4 border-black p-4 heading-font animate-bounce cursor-pointer hover:bg-black hover:text-white transition-colors" data-i18n="shop_btn">SHOP KICKS ‚Üì</div>
            </div>
        </header>

        <section id="catalog" class="py-32 px-4 bg-[#E2A900]">
            <h2 class="heading-font text-6xl text-center mb-20 underline decoration-8 underline-offset-8" data-i18n="catalog_title">LES_PEBITAS</h2>
            <div id="product-list" class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </section>

        <section class="py-24 bg-white px-4 border-t-8 border-black">
            <div class="max-w-4xl mx-auto">
                <div class="bg-black text-[#E2A900] p-1 border-4 border-black inline-block mb-8 neo-brutal-shadow-sm font-bold">
                    <h3 class="heading-font text-3xl px-4 py-2" data-i18n="find_us">NOUS_TROUVER</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div onclick="showView('map')" class="bg-[#E2A900] text-black border-8 border-black p-8 neo-brutal-shadow-hover transition-all cursor-pointer">
                        <h4 class="heading-font text-4xl mb-4" data-i18n="address_title">L'ADRESSE üìç</h4>
                        <p class="text-3xl font-black uppercase leading-tight">Av. Souidani Boudjemaa<br>Sidi M'Hamed 16000</p>
                        <p class="mt-4 underline font-bold" data-i18n="see_hours">VOIR LES HORAIRES ‚Üí</p>
                    </div>
                    <div class="bg-white text-black border-8 border-black p-8 neo-brutal-shadow-hover transition-all">
                        <h4 class="heading-font text-4xl mb-4" data-i18n="contact_title">CONTACT üìû</h4>
                        <p class="text-4xl font-black tracking-tighter">0557 30 03 96</p>
                        <p class="mt-4 font-bold italic underline" data-i18n="contact_sub">DISPONIBLE POUR LA MAGIE</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <main id="auth-view" class="view-section py-32 px-4 bg-white min-h-screen">
        <div class="max-w-md mx-auto border-8 border-black p-8 neo-brutal-shadow bg-[#E2A900]">
            <h2 class="heading-font text-4xl mb-8 text-center bg-black text-white p-2">CONNEXION</h2>
            <button onclick="loginGoogle()" class="w-full bg-white border-4 border-black p-4 mb-6 font-bold flex items-center justify-center gap-2 hover:bg-gray-100">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-6 h-6"> Continuer avec Google
            </button>
            <div class="text-center font-bold mb-4">- OU -</div>
            <div class="flex mb-4 bg-white border-4 border-black">
                <button onclick="toggleAuthMode('login')" id="btn-login-mode" class="flex-1 p-2 font-bold bg-black text-white">Login</button>
                <button onclick="toggleAuthMode('signup')" id="btn-signup-mode" class="flex-1 p-2 font-bold">Sign Up</button>
            </div>
            <div id="email-form">
                <input type="email" id="auth-email" class="input-neo mb-2" placeholder="Email">
                <input type="password" id="auth-pass" class="input-neo mb-4" placeholder="Mot de passe">
                <button id="auth-action-btn" onclick="handleEmailAuth()" class="w-full bg-black text-white p-4 heading-font neo-brutal-shadow-hover">SE CONNECTER</button>
            </div>
            <button onclick="showView('home')" class="mt-6 text-sm font-bold underline w-full text-center">Retour au site</button>
        </div>
    </main>

    <main id="product-view" class="view-section py-32 px-4">
        <div class="max-w-7xl mx-auto" id="product-detail-container"></div>
    </main>

    <main id="orders-view" class="view-section py-32 px-4 bg-white min-h-screen">
        <div class="max-w-4xl mx-auto">
            <h2 class="heading-font text-5xl mb-8 border-b-8 border-black pb-4">MES_COMMANDES</h2>
            
            <div id="not-connected-msg" class="hidden p-8 border-4 border-black bg-yellow-100 text-center font-bold mb-8">
                Connecte-toi pour voir ton historique ! <br>
                <button onclick="showView('auth')" class="mt-4 bg-black text-white px-6 py-2">CONNEXION</button>
            </div>

            <div id="orders-list" class="space-y-8"></div>
            
            <button onclick="showView('home')" class="mt-12 bg-black text-white px-10 py-5 heading-font neo-brutal-shadow-sm hover:bg-gray-800 transition-all">‚Üê RETOUR</button>
        </div>
    </main>

    <main id="map-view" class="view-section py-32 px-4 bg-white min-h-screen">
        <div class="max-w-6xl mx-auto">
            <div class="bg-black text-[#E2A900] p-6 border-8 border-black mb-12 neo-brutal-shadow">
                <h2 class="heading-font text-5xl md:text-7xl mb-2" data-i18n="map_header">LOCALISATION</h2>
                <p class="text-2xl font-bold italic">Av. Souidani Boudjemaa, Sidi M'Hamed 16000</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 border-8 border-black neo-brutal-shadow h-[500px] bg-gray-200">
                    <iframe width="100%" height="100%" frameborder="0" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3197.4339459325996!2d3.0478051764669866!3d36.74813587093375!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x128fb263914a383b%3A0x600b6529b5a2e58a!2sAv.%20Souidani%20Boudjemaa%2C%20Sidi%20M'Hamed!5e0!3m2!1sfr!2sdz!4v1715872145612!5m2!1sfr!2sdz" style="filter: grayscale(1);"></iframe>
                </div>
                <div class="bg-[#E2A900] border-8 border-black p-6 neo-brutal-shadow">
                    <h3 class="heading-font text-3xl mb-6 border-b-4 border-black pb-2" data-i18n="hours_title">HORAIRES</h3>
                    <ul class="space-y-3 font-bold text-xl uppercase" id="hours-list"></ul>
                </div>
            </div>
            <button onclick="showView('home')" class="mt-12 bg-black text-white px-10 py-5 heading-font neo-brutal-shadow-hover transition-all" data-i18n="back_btn">‚Üê RETOUR</button>
        </div>
    </main>

    <main id="checkout-view" class="view-section py-32 px-4 bg-white min-h-screen">
        <div class="max-w-2xl mx-auto border-8 border-black p-8 neo-brutal-shadow bg-white">
            <div id="checkout-form-container">
                <h2 class="heading-font text-4xl mb-8 border-b-4 border-black pb-2" data-i18n="checkout_header">INFOS_LIVRAISON</h2>
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="font-bold uppercase" data-i18n="form_name">Nom</label><input type="text" id="c-nom" class="input-neo"></div>
                        <div><label class="font-bold uppercase" data-i18n="form_fname">Pr√©nom</label><input type="text" id="c-prenom" class="input-neo"></div>
                    </div>
                    <div><label class="font-bold uppercase" data-i18n="form_phone">T√©l√©phone</label><input type="tel" id="c-phone" class="input-neo" placeholder="05XX XX XX XX"></div>
                    <div><label class="font-bold uppercase">Wilaya</label><select id="c-wilaya" class="input-neo"></select></div>
                    <div><label class="font-bold uppercase" data-i18n="form_address">Adresse</label><textarea id="c-adresse" class="input-neo" rows="3"></textarea></div>
                    <button type="button" onclick="finaliserLaCaisse()" class="w-full bg-black text-[#E2A900] p-6 heading-font text-2xl neo-brutal-shadow-hover transition-all" data-i18n="confirm_btn">CONFIRMER LA COMMANDE</button>
                </div>
            </div>
            <div id="checkout-success" class="hidden text-center py-10">
                <div class="border-8 border-black p-8 bg-[#E2A900] mb-8">
                    <h3 class="heading-font text-3xl mb-4" data-i18n="success_msg">COMMANDE PASS√âE !</h3>
                    <p class="text-xl font-bold"><span data-i18n="callback_msg">On vous rappelle sur :</span> <span id="res-num" class="bg-black text-white px-2 italic"></span></p>
                </div>
                <div class="flex flex-col gap-4">
                    <button onclick="showView('orders')" class="bg-white text-black border-4 border-black px-8 py-4 heading-font neo-brutal-shadow-sm">VOIR MA COMMANDE</button>
                    <button onclick="resetCheckoutForm()" class="bg-black text-white px-8 py-4 heading-font neo-brutal-shadow-sm" data-i18n="back_stadium">RETOUR AU STADE</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black text-[#E2A900] border-t-8 border-black pt-20 pb-10 px-4 text-center">
        <h1 class="heading-font text-4xl md:text-8xl mb-10">R10_STORE</h1>
        <p class="uppercase font-bold tracking-widest">¬© 2026 Ronaldinho Store10 ‚Äî Sidi M'Hamed District</p>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCrEd8zSy5bBape6ws3v7mvTavcZfhCKM8",
            authDomain: "r10-store-f6bb3.firebaseapp.com",
            projectId: "r10-store-f6bb3",
            storageBucket: "r10-store-f6bb3.firebasestorage.app",
            messagingSenderId: "154441292816",
            appId: "1:154441292816:web:2390d040a37d7052fdbe95",
            measurementId: "G-P3GPZVC0Z5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        const translations = {
            fr: {
                cart_title: "TON_PANIER", total: "TOTAL", checkout_btn: "FINALISER LA COMMANDE", nav_cart: "PANIER",
                hero_1: "RONALDINHO", hero_2: "STORE", quote: '"L\'art du dribble commence par le bon appui."',
                shop_btn: "SHOP KICKS ‚Üì", catalog_title: "Nos Produits", find_us: "NOUS_TROUVER",
                address_title: "L'ADRESSE üìç", see_hours: "VOIR LES HORAIRES ‚Üí", contact_title: "CONTACT üìû",
                contact_sub: "DISPONIBLE POUR LA MAGIE", map_header: "LOCALISATION", hours_title: "HORAIRES",
                back_btn: "‚Üê RETOUR", checkout_header: "INFOS_LIVRAISON", form_name: "Nom", form_fname: "Pr√©nom",
                form_phone: "T√©l√©phone", form_address: "Adresse", confirm_btn: "CONFIRMER LA COMMANDE",
                success_msg: "COMMANDE PASS√âE !", callback_msg: "On vous rappelle sur :", back_stadium: "RETOUR AU STADE",
                days: ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"], add_to_cart: "AJOUTER AU PANIER"
            },
            en: {
                cart_title: "YOUR_CART", total: "TOTAL", checkout_btn: "CHECKOUT NOW", nav_cart: "CART",
                hero_1: "RONALDINHO", hero_2: "STORE", quote: '"Dribbling art starts with the right grip."',
                shop_btn: "SHOP KICKS ‚Üì", catalog_title: "Our Products", find_us: "FIND_US",
                address_title: "ADDRESS üìç", see_hours: "SEE OPENING HOURS ‚Üí", contact_title: "CONTACT üìû",
                contact_sub: "AVAILABLE FOR MAGIC", map_header: "LOCATION", hours_title: "OPENING HOURS",
                back_btn: "‚Üê BACK", checkout_header: "DELIVERY_INFO", form_name: "Last Name", form_fname: "First Name",
                form_phone: "Phone Number", form_address: "Full Address", confirm_btn: "CONFIRM ORDER",
                success_msg: "ORDER PLACED !", callback_msg: "We will call you back at:", back_stadium: "BACK TO STADIUM",
                days: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"], add_to_cart: "ADD TO CART"
            }
        };

        let currentLang = 'fr';
        let products = [];
        let cart = [];
        let selectedSize = null;
        let currentUser = null;
        const wilayas = ["01 Adrar", "02 Chlef", "03 Laghouat", "04 Oum El Bouaghi", "05 Batna", "06 B√©ja√Øa", "07 Biskra", "08 B√©char", "09 Blida", "10 Bouira", "11 Tamanrasset", "12 T√©bessa", "13 Tlemcen", "14 Tiaret", "15 Tizi Ouzou", "16 Alger", "17 Djelfa", "18 Jijel", "19 S√©tif", "20 Sa√Øda", "21 Skikda", "22 Sidi Bel Abb√®s", "23 Annaba", "24 Guelma", "25 Constantine", "26 M√©d√©a", "27 Mostaganem", "28 M'Sila", "29 Mascara", "30 Ouargla", "31 Oran", "32 El Bayadh", "33 Illizi", "34 Bordj Bou Arreridj", "35 Boumerd√®s", "36 El Tarf", "37 Tindouf", "38 Tissemsilt", "39 El Oued", "40 Khenchela", "41 Souk Ahras", "42 Tipaza", "43 Mila", "44 A√Øn Defla", "45 Na√¢ma", "46 A√Øn T√©mouchent", "47 Gharda√Øa", "48 Relizane", "49 El M'Ghair", "50 El Meniaa", "51 Ouled Djellal", "52 Bordj Baji Mokhtar", "53 B√©ni Abb√®s", "54 Timimoun", "55 Touggourt", "56 Djanet", "57 In Salah", "58 In Guezzam"];

        // VIDER HISTORIQUE (Pour repartir √† z√©ro comme sur la photo)
        if (!localStorage.getItem('r10_reset_v5')) {
            localStorage.removeItem('r10_orders');
            localStorage.setItem('r10_reset_v5', 'true');
        }

        // AUTH
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                document.getElementById('sidebar-auth-logged-out').classList.add('hidden');
                document.getElementById('sidebar-auth-logged-in').classList.remove('hidden');
                document.getElementById('sidebar-user-email').innerText = user.email;
                document.getElementById('not-connected-msg').classList.add('hidden');
                loadUserData(user.uid);
            } else {
                document.getElementById('sidebar-auth-logged-out').classList.remove('hidden');
                document.getElementById('sidebar-auth-logged-in').classList.add('hidden');
                document.getElementById('not-connected-msg').classList.remove('hidden');
                // AFFICHE LE MESSAGE VIDE PAR DEFAUT
                document.getElementById('orders-list').innerHTML = `
                    <div class="p-12 border-4 border-dashed border-black text-center font-bold text-2xl uppercase opacity-50">
                        AUCUNE COMMANDE POUR LE MOMENT
                    </div>`;
            }
        });

        async function loadUserData(uid) {
            const doc = await db.collection("users").doc(uid).get();
            if (doc.exists) {
                const d = doc.data();
                if(document.getElementById('c-nom')) {
                    document.getElementById('c-nom').value = d.nom || "";
                    document.getElementById('c-prenom').value = d.prenom || "";
                    document.getElementById('c-phone').value = d.phone || "";
                    document.getElementById('c-wilaya').value = d.wilaya || "";
                    document.getElementById('c-adresse').value = d.adresse || "";
                }
            }
        }

        let authMode = 'login';
        function toggleAuthMode(mode) {
            authMode = mode;
            const btn = document.getElementById('auth-action-btn');
            if (mode === 'login') {
                document.getElementById('btn-login-mode').classList.add('bg-black', 'text-white');
                document.getElementById('btn-signup-mode').classList.remove('bg-black', 'text-white');
                btn.innerText = "SE CONNECTER";
            } else {
                document.getElementById('btn-login-mode').classList.remove('bg-black', 'text-white');
                document.getElementById('btn-signup-mode').classList.add('bg-black', 'text-white');
                btn.innerText = "S'INSCRIRE";
            }
        }

        async function handleEmailAuth() {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            try {
                if (authMode === 'login') await auth.signInWithEmailAndPassword(email, pass);
                else await auth.createUserWithEmailAndPassword(email, pass);
                showView('home');
            } catch (e) { alert("Erreur: " + e.message); }
        }

        async function loginGoogle() {
            try {
                await auth.signInWithPopup(googleProvider);
                showView('home');
            } catch (e) { alert("Erreur Google: " + e.message); }
        }

        function logout() { auth.signOut(); showView('home'); }

        // CATALOGUE
        db.collection("products").onSnapshot((snapshot) => {
            products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderCatalog();
        });

        function toggleLang() {
            currentLang = currentLang === 'fr' ? 'en' : 'fr';
            document.getElementById('langBtn').innerText = currentLang === 'fr' ? 'EN' : 'FR';
            applyTranslations();
            renderCatalog(); 
        }

        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.innerText = translations[currentLang][key];
            });
            renderHours();
        }

        function renderHours() {
            const times = ["12:30‚Äì22:00", "12:30‚Äì22:00", "12:30‚Äì22:00", "12:30‚Äì22:00", "16:30‚Äì23:00", "12:30‚Äì22:00", "12:30‚Äì22:00"];
            const list = document.getElementById('hours-list');
            if (list) {
                list.innerHTML = translations[currentLang].days.map((day, i) => `
                    <li class="flex justify-between border-b-2 border-black/20 pb-1 ${i===4?'text-white bg-black px-1':''}">
                        <span>${day}</span> <span>${times[i]}</span>
                    </li>`).join('');
            }
        }

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewId}-view`).classList.add('active');
            window.scrollTo(0,0);
            if(viewId === 'orders') renderOrders();
        }

        function toggleCart(isOpen) {
            document.getElementById('cart-sidebar').classList.toggle('open', isOpen);
            document.getElementById('cart-overlay').classList.toggle('open', isOpen);
            if(isOpen) renderSidebarCart();
        }

        function renderCatalog() {
            const list = document.getElementById('product-list');
            if (list) {
                list.innerHTML = products.map(p => {
                    const isOutOfStock = p.stock <= 0;
                    return `
                    <div class="bg-white border-4 border-black p-6 neo-brutal-shadow-hover flex flex-col cursor-pointer relative" onclick="${isOutOfStock ? '' : `renderProductDetail('${p.id}')`}">
                        ${isOutOfStock ? '<div class="sold-out-badge">STOCK √âPUIS√â</div>' : ''}
                        <img src="${p.img}" class="w-full h-64 object-cover mb-4 border-4 border-black ${isOutOfStock ? 'grayscale-img' : ''}" onerror="this.src='https://via.placeholder.com/400x400?text=Sneakers'">
                        <h4 class="heading-font text-2xl">${p.name}</h4>
                        <p class="font-black text-xl">${p.price} DA</p>
                    </div>`;
                }).join('');
            }
        }

        function renderProductDetail(id) {
            const p = products.find(x => x.id === id);
            const isOutOfStock = p.stock <= 0;
            selectedSize = null;
            document.getElementById('product-detail-container').innerHTML = `
                <button onclick="showView('home')" class="mb-12 bg-black text-white p-4 heading-font neo-brutal-shadow-sm">${translations[currentLang].back_btn}</button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                    <img src="${p.img}" class="border-8 border-black neo-brutal-shadow rotate-[-2deg] ${isOutOfStock ? 'grayscale-img' : ''}" onerror="this.src='https://via.placeholder.com/800x800?text=Sneakers'">
                    <div class="bg-black text-[#E2A900] p-10 border-8 border-white neo-brutal-shadow">
                        <h2 class="heading-font text-5xl mb-4">${p.name}</h2>
                        <p class="mb-6 font-bold text-lg">${isOutOfStock ? (currentLang === 'fr' ? 'Stock √©puis√©' : 'Out of Stock') : p.longDesc}</p>
                        <div class="flex flex-wrap gap-2 mb-8">
                            ${(p.sizes || []).map(s => `<button onclick="${isOutOfStock ? '' : `selectSize('${s}')`}" data-size="${s}" class="size-btn border-2 border-white px-4 py-2 text-white font-bold ${isOutOfStock ? 'opacity-30 cursor-not-allowed' : 'hover:bg-white hover:text-black transition-colors'}">${s}</button>`).join('')}
                        </div>
                        <button onclick="${isOutOfStock ? '' : `addToCart('${p.id}')`}" class="w-full ${isOutOfStock ? 'bg-gray-600 cursor-not-allowed' : 'bg-[#E2A900] text-black neo-brutal-shadow-hover'} p-6 heading-font text-2xl">
                            ${isOutOfStock ? (currentLang === 'fr' ? 'STOCK √âPUIS√â' : 'OUT OF STOCK') : translations[currentLang].add_to_cart}
                        </button>
                    </div>
                </div>`;
            showView('product');
        }

        function selectSize(s) { selectedSize = s; document.querySelectorAll('.size-btn').forEach(b => b.classList.toggle('size-selected', b.dataset.size == s)); }
        function addToCart(id) { if(!selectedSize) { alert("Choisis une pointure !"); return; } const p = products.find(x => x.id === id); cart.push({...p, size: selectedSize}); updateCartCount(); toggleCart(true); }
        function updateCartCount() { document.getElementById('cart-count').innerText = cart.length; }
        function renderSidebarCart() {
            const cont = document.getElementById('sidebar-cart-items');
            if(cart.length === 0) { cont.innerHTML= `<div class='text-center py-10 opacity-50'>${currentLang === 'fr' ? 'TON PANIER EST VIDE' : 'EMPTY CART'}</div>`; return; }
            let total = 0;
            cont.innerHTML = cart.map((i, index) => { total+=i.price; return `<div class="border-4 border-black p-4 mb-2 bg-gray-50 flex justify-between items-center"><div><b class="block">${i.name}</b><span class="text-sm">Taille: ${i.size}</span></div><div class="flex items-center gap-4"><span>${i.price} DA</span><button onclick="removeFromCart(${index})" class="text-red-600 border-2 border-black px-2 hover:bg-black hover:text-white">X</button></div></div>` }).join('');
            document.getElementById('sidebar-total').innerText = total + " DA";
        }
        function removeFromCart(index) { cart.splice(index, 1); updateCartCount(); renderSidebarCart(); }
        function goToCheckout() { if(cart.length === 0) return; toggleCart(false); showView('checkout'); if(currentUser) loadUserData(currentUser.uid); }

        function resetCheckoutForm() {
            showView('home');
            setTimeout(() => {
                document.getElementById('checkout-form-container').classList.remove('hidden');
                document.getElementById('checkout-success').classList.add('hidden');
            }, 500);
        }

        async function finaliserLaCaisse() {
            const nom = document.getElementById('c-nom').value;
            const prenom = document.getElementById('c-prenom').value;
            const num = document.getElementById('c-phone').value;
            const wilaya = document.getElementById('c-wilaya').value;
            const adresse = document.getElementById('c-adresse').value;

            if(!num || !nom) return alert("Veuillez remplir les informations !");

            const orderData = {
                userId: currentUser ? currentUser.uid : "guest",
                client: nom + " " + prenom,
                phone: num,
                wilaya: wilaya,
                adresse: adresse,
                items: cart,
                total: cart.reduce((acc, curr) => acc + curr.price, 0),
                status: "En attente de rappel",
                date: new Date().toLocaleString('fr-FR'),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if(currentUser) await db.collection("users").doc(currentUser.uid).set({ nom, prenom, phone: num, wilaya, adresse }, { merge: true });

            try {
                await db.collection("orders").add(orderData);
                document.getElementById('checkout-form-container').classList.add('hidden');
                document.getElementById('res-num').innerText = num;
                document.getElementById('checkout-success').classList.remove('hidden');
                cart = []; updateCartCount();
            } catch(e) {
                alert("Erreur de commande : " + e.message);
            }
        }

        // --- AFFICHAGE AVEC TRI C√îT√â CLIENT (POUR EVITER L'ERREUR D'INDEX) ---
        function renderOrders() {
            if (!currentUser) return;
            
            // On enl√®ve le orderBy("timestamp") qui faisait planter l'affichage vide
            db.collection("orders")
              .where("userId", "==", currentUser.uid)
              .onSnapshot(snapshot => {
                const list = document.getElementById('orders-list');
                
                if(snapshot.empty) {
                    list.innerHTML = `<div class="p-12 border-4 border-dashed border-black text-center font-bold text-2xl uppercase opacity-50">AUCUNE COMMANDE POUR LE MOMENT</div>`;
                    return;
                }

                // On trie manuellement ici
                let docs = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                docs.sort((a, b) => (b.timestamp ? b.timestamp.seconds : 0) - (a.timestamp ? a.timestamp.seconds : 0));

                list.innerHTML = docs.map(order => {
                    let statusClass = "bg-black text-[#E2A900]";
                    let statusText = order.status;

                    if(order.status === "Confirm√©") {
                        statusText = "‚úÖ COMMANDE ACCEPT√âE";
                        statusClass = "bg-green-600 text-white border-2 border-black";
                    } else if (order.status === "Rejet√©") {
                        statusText = "‚ùå COMMANDE REFUS√âE";
                        statusClass = "bg-red-600 text-white border-2 border-black";
                    }

                    return `
                    <div class="border-8 border-black p-6 neo-brutal-shadow bg-white">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 border-b-4 border-black pb-4">
                            <div><p class="text-sm font-bold opacity-50">COMMANDE #${order.id.substring(0,6)}</p><p class="heading-font text-xl">${order.date}</p></div>
                            <div class="${statusClass} px-4 py-2 font-black uppercase text-sm italic">${statusText}</div>
                        </div>
                        <div class="space-y-4 mb-6">${order.items.map(item => `<div class="flex justify-between items-center font-bold"><span>${item.name} (T: ${item.size})</span><span>${item.price} DA</span></div>`).join('')}</div>
                        <div class="flex justify-between items-center pt-4 border-t-4 border-black font-black text-2xl heading-font"><span>TOTAL</span><span>${order.total} DA</span></div>
                    </div>`;
                }).join('');
            });
        }

        window.onload = () => {
            const selectW = document.getElementById('c-wilaya');
            if(selectW) wilayas.forEach(w => { let opt = document.createElement('option'); opt.value = w; opt.innerHTML = w; selectW.appendChild(opt); });
            document.addEventListener('mousemove', (e) => { const c = document.getElementById('cursor'); if(c) { c.style.left = e.clientX + 'px'; c.style.top = e.clientY + 'px'; } });
            
            renderHours(); 
            applyTranslations(); 
            updateCartCount();
        };
    </script>
</body>
</html>